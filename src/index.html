<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MovieFrameSnap Lite</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <!-- メインコンテナ -->
    <div class="container">

        <!-- メインコンテンツエリア -->
        <main class="main-content">

            <!-- 左サイドバー: コントロールパネル -->
            <aside class="sidebar">

                <!-- アプリ名 -->
                <div class="app-title">
                    <h1>MovieFrameSnap Lite</h1>
                </div>

                <!-- 1. プロジェクト選択（タブ式） -->
                <section class="control-section">
                    <h2>1. 開始</h2>

                    <!-- タブナビゲーション -->
                    <div class="start-tab-navigation">
                        <button class="start-tab-btn active" data-start-tab="new">📁 新規作成</button>
                        <button class="start-tab-btn" data-start-tab="open">📂 編集再開</button>
                    </div>

                    <!-- 新規作成タブ -->
                    <div class="start-tab-content active" id="newProjectTab">
                        <div class="file-input-area">
                            <input type="file" id="videoInput" accept="video/*" class="file-input">
                            <label for="videoInput" class="file-label">
                                ファイルを選択 / ドロップ
                            </label>
                        </div>
                        <p id="fileName" class="file-name"></p>
                    </div>

                    <!-- 既存を開くタブ -->
                    <div class="start-tab-content" id="openProjectTab">
                        <button id="loadProjectBtn" class="btn-primary">📂 プロジェクトを開く</button>
                        <p class="help-text">保存済みのプロジェクトフォルダを選択して、編集を再開できます</p>
                        <button id="saveProjectBtn" class="btn" disabled>💾 プロジェクトを保存</button>
                    </div>
                </section>

                <!-- 2. 動画の範囲を指定 -->
                <section class="control-section">
                    <details open>
                        <summary><h2>2. 動画の範囲を指定</h2></summary>
                        <div class="range-controls">
                            <!-- 範囲スライダー -->
                            <div class="range-slider">
                                <input type="range" id="startSlider" min="0" max="100" value="0" step="0.1" disabled>
                                <input type="range" id="endSlider" min="0" max="100" value="100" step="0.1" disabled>
                            </div>

                            <!-- 開始時刻 -->
                            <div class="time-input-group">
                                <div class="time-label-row">
                                    <label>開始:</label>
                                    <button id="setStartBtn" class="btn-tiny" disabled>現在位置</button>
                                </div>
                                <input type="text" id="startTime" value="00:00:00" disabled>
                            </div>

                            <!-- 終了時刻 -->
                            <div class="time-input-group">
                                <div class="time-label-row">
                                    <label>終了:</label>
                                    <button id="setEndBtn" class="btn-tiny" disabled>現在位置</button>
                                </div>
                                <input type="text" id="endTime" value="00:00:00" disabled>
                            </div>

                            <!-- 範囲情報 -->
                            <p class="range-info">選択範囲: <span id="rangeDisplay">00:00:00</span></p>

                            <!-- 範囲操作ボタン -->
                            <div class="range-buttons">
                                <button id="playRangeBtn" class="btn" disabled>範囲を再生</button>
                                <button id="resetRangeBtn" class="btn" disabled>全範囲</button>
                            </div>
                        </div>
                    </details>
                </section>

                <!-- 3. 画像抽出（手動） -->
                <section class="control-section">
                    <h2>3. 画像抽出（手動）</h2>
                    <div class="extract-controls">
                        <!-- オプション -->
                        <label class="checkbox-label">
                            <input type="checkbox" id="includeTimestamp" checked>
                            タイムスタンプを表示
                        </label>
                        <label class="checkbox-label">
                            <input type="checkbox" id="includeShapes">
                            図形アノテーションを含める
                        </label>
                        <label class="checkbox-label">
                            <input type="checkbox" id="includeTextAnnotations">
                            テキスト注釈を含める
                        </label>

                        <!-- 抽出ボタン -->
                        <button id="extractFrameBtn" class="btn-primary" disabled>
                            📸 現在位置の画像を抽出
                        </button>
                    </div>
                </section>

            </aside>

            <!-- 中央: 動画プレビューエリア -->
            <div class="video-area">

                <!-- 動画プレビュー -->
                <div class="video-wrapper">
                    <div class="video-container">
                        <video id="videoPlayer" controls></video>
                        <canvas id="annotationCanvas"></canvas>
                    </div>
                    <div id="textAnnotationDisplay" class="text-annotation-display"></div>
                    <div id="detailTextDisplay" class="detail-text-display"></div>
                </div>

                <!-- 動画コントロール -->
                <div class="video-controls">
                    <div class="control-row">
                        <label>タイトル:</label>
                        <input type="text" id="projectTitle" placeholder="動画ファイル名から自動入力" disabled>
                    </div>
                    <div class="control-row">
                        <label>再生速度:</label>
                        <input type="number" id="playbackSpeed" value="1.0" min="0.25" max="4.0" step="0.25" disabled>
                        <span>×</span>
                        <label class="checkbox-label" style="margin-left: 15px;">
                            <input type="checkbox" id="includeAudio" checked disabled>
                            音声を含む
                        </label>
                        <label class="checkbox-label">
                            <input type="checkbox" id="includeVideoAnnotations" checked disabled>
                            テキスト注釈を含む
                        </label>
                    </div>
                    <button id="downloadVideoBtn" class="btn-primary" disabled>
                        ⬇ トリミング動画をダウンロード
                    </button>
                </div>

            </div>

            <!-- 右サイドバー: 注釈エリア -->
            <aside class="sidebar-right">

                <!-- タブナビゲーション -->
                <div class="tab-navigation">
                    <button class="tab-btn active" data-tab="text">注釈</button>
                    <button class="tab-btn" data-tab="shape">図形</button>
                    <button class="tab-btn" data-tab="detail">詳細</button>
                </div>

                <!-- テキスト注釈タブ -->
                <div class="tab-content active" id="textTab">
                    <section class="annotation-section">
                        <h2 class="sr-only">テキスト注釈</h2>

                    <!-- 時刻調整ボタン -->
                    <div class="time-adjust-controls compact">
                        <div class="time-adjust-row">
                            <button class="btn-tiny" data-adjust="10" disabled>+10秒</button>
                            <button class="btn-tiny" data-adjust="1" disabled>+1秒</button>
                            <button class="btn-tiny" data-adjust="0.1" disabled>+0.1秒</button>
                            <button class="btn-tiny" id="syncAnnotationTime" disabled>現在位置</button>
                        </div>
                        <div class="time-adjust-row">
                            <button class="btn-tiny" data-adjust="-10" disabled>-10秒</button>
                            <button class="btn-tiny" data-adjust="-1" disabled>-1秒</button>
                            <button class="btn-tiny" data-adjust="-0.1" disabled>-0.1秒</button>
                            <button class="btn-tiny" id="resetAnnotationTime" disabled>リセット</button>
                        </div>
                    </div>

                    <!-- テキスト注釈セクション -->
                    <div class="annotation-subsection text-annotation-section">
                        <h3 class="subsection-header">📝 テキスト注釈</h3>

                        <!-- フォント選択（1行圧縮） -->
                        <div class="font-selection-section compact">
                            <label>フォント:</label>
                            <select id="textFontSelect" disabled>
                                <option value="Noto Sans JP">角ゴシック（細）</option>
                                <option value="M PLUS Rounded 1c">丸ゴシック</option>
                                <option value="Zen Kaku Gothic New">角ゴシック（太）</option>
                            </select>
                        </div>

                        <!-- テキスト入力（2行） -->
                        <div class="two-line-input-section compact">
                            <label>注釈テキスト:</label>
                            <p class="help-text-small">チェックオン：連番が自動で採番されます</p>
                            <div class="input-with-checkbox">
                                <input type="checkbox" id="annotationText1UseSeq" class="seq-checkbox" disabled>
                                <input type="text" id="annotationText1" placeholder="1段目（10文字まで）" maxlength="10" disabled>
                            </div>
                            <input type="text" id="annotationText2" placeholder="2段目（10文字まで）" maxlength="10" disabled>
                        </div>

                        <!-- 配色プリセット（縮小） -->
                        <div class="color-preset-section compact">
                            <label>配色:</label>
                            <div class="preset-buttons">
                                <button class="preset-btn active" data-preset="explanation" data-text-color="#000000" data-bg-color="#FFFFFF" data-text-align="center">説明</button>
                                <button class="preset-btn" data-preset="point" data-text-color="#000000" data-bg-color="#FFE5E0" data-text-align="center">要点</button>
                                <button class="preset-btn" data-preset="caution" data-text-color="#000000" data-bg-color="#FFF9E6" data-text-align="center">注意</button>
                                <button class="preset-btn" id="customPresetBtn" data-preset="custom" data-text-color="#000000" data-bg-color="#FFFFFF" data-text-align="center">登録</button>
                            </div>
                        </div>

                        <!-- カスタム設定（折りたたみ可能） -->
                        <details class="custom-color-section">
                            <summary>カスタム</summary>
                            <div class="custom-color-inputs">
                                <div class="color-input-row">
                                    <label>文字色:</label>
                                    <input type="color" id="customTextColor" value="#000000" disabled>
                                </div>
                                <div class="color-input-row">
                                    <label>背景色:</label>
                                    <input type="color" id="customBgColor" value="#FFFFFF" disabled>
                                </div>
                                <div class="text-align-section">
                                    <label>文字位置:</label>
                                    <div class="text-align-buttons">
                                        <button class="text-align-btn" data-align="left" disabled>左</button>
                                        <button class="text-align-btn active" data-align="center" disabled>中央</button>
                                        <button class="text-align-btn" data-align="right" disabled>右</button>
                                    </div>
                                </div>
                                <button id="saveCustomPresetBtn" class="btn-save-preset" disabled>📌 登録</button>
                            </div>
                        </details>

                        <button id="addAnnotationBtn" class="btn compact" disabled>📌 追加</button>
                        <button id="addBlankAnnotationBtn" class="btn compact" disabled>注釈なし</button>

                        <!-- 注釈リスト -->
                        <div id="annotationList" class="annotation-list">
                            <p class="empty-message">注釈が登録されていません</p>
                        </div>
                    </div>

                    <!-- 方向矢印セクション -->
                    <div class="annotation-subsection arrow-annotation-section">
                        <h3 class="subsection-header">➡ 方向矢印</h3>

                        <!-- 方向選択 -->
                        <div class="arrow-selection">
                            <button class="arrow-btn" data-arrow="left" disabled>←左</button>
                            <button class="arrow-btn" data-arrow="right" disabled>右→</button>
                            <label style="margin-left: 10px;">サイズ:</label>
                            <select id="arrowSizeSelect" disabled>
                                <option value="2">2px</option>
                                <option value="3">3px</option>
                                <option value="5" selected>5px</option>
                                <option value="7">7px</option>
                                <option value="10">10px</option>
                            </select>
                        </div>

                        <!-- 色選択 -->
                        <div class="arrow-color-section">
                            <label>色:</label>
                            <div class="arrow-color-buttons">
                                <button class="arrow-color-btn active" data-color="#1976D2" data-arrow="left" style="background-color: #1976D2;" title="青（左）">青</button>
                                <button class="arrow-color-btn active" data-color="#FF9800" data-arrow="right" style="background-color: #FF9800;" title="オレンジ（右）">橙</button>
                            </div>
                        </div>

                        <button id="addArrowBtn" class="btn compact" disabled>矢印追加</button>

                        <!-- 矢印リスト -->
                        <div id="arrowList" class="arrow-list">
                            <p class="empty-message">方向矢印が登録されていません</p>
                        </div>
                    </div>

                    </section>
                </div>

                <!-- 図形アノテーションタブ -->
                <div class="tab-content" id="shapeTab">
                    <section class="annotation-section">
                        <h2 class="sr-only">図形アノテーション</h2>

                    <!-- 時刻調整ボタン -->
                    <div class="time-adjust-controls">
                        <div class="time-adjust-row">
                            <button class="btn-tiny" data-adjust-shape="10" disabled>+10秒</button>
                            <button class="btn-tiny" data-adjust-shape="1" disabled>+1秒</button>
                            <button class="btn-tiny" data-adjust-shape="0.1" disabled>+0.1秒</button>
                            <button class="btn-tiny" id="syncShapeTime" disabled>現在位置</button>
                        </div>
                        <div class="time-adjust-row">
                            <button class="btn-tiny" data-adjust-shape="-10" disabled>-10秒</button>
                            <button class="btn-tiny" data-adjust-shape="-1" disabled>-1秒</button>
                            <button class="btn-tiny" data-adjust-shape="-0.1" disabled>-0.1秒</button>
                            <button class="btn-tiny" id="resetShapeTime" disabled>リセット</button>
                        </div>
                    </div>

                    <!-- 図形選択 -->
                    <div class="shape-selector">
                        <button class="shape-btn" data-shape="line">直線</button>
                        <button class="shape-btn" data-shape="rectangle">四角</button>
                        <button class="shape-btn" data-shape="erase">消去</button>
                        <button class="shape-btn" data-shape="none">解除</button>
                    </div>
                    <div class="shape-selector">
                        <button class="shape-btn" data-shape="arrow-right">➡</button>
                        <button class="shape-btn" data-shape="arrow-left">⬅</button>
                        <button class="shape-btn" data-shape="arrow-up">⬆</button>
                        <button class="shape-btn" data-shape="arrow-down">⬇</button>
                    </div>

                    <!-- 枠線色選択（6色パネル） -->
                    <div class="shape-color-panel-section">
                        <label>枠線色:</label>
                        <div class="shape-color-panel">
                            <button class="shape-color-btn" data-color="#FFFFFF" style="background-color: #FFFFFF; border: 2px solid #ddd;" title="白"></button>
                            <button class="shape-color-btn" data-color="#E3F2FD" style="background-color: #E3F2FD; border: 2px solid #ddd;" title="水色"></button>
                            <button class="shape-color-btn" data-color="#FFE5E0" style="background-color: #FFE5E0; border: 2px solid #ddd;" title="サーモン"></button>
                            <button class="shape-color-btn active" data-color="#FF0000" style="background-color: #FF0000;" title="赤"></button>
                            <button class="shape-color-btn" data-color="#FFDD00" style="background-color: #FFDD00;" title="黄色"></button>
                            <button class="shape-color-btn" data-color="#000000" style="background-color: #000000;" title="黒"></button>
                        </div>
                    </div>

                    <!-- カスタム色選択（折りたたみ可能） -->
                    <details class="custom-color-section">
                        <summary>カスタム色</summary>
                        <div class="custom-color-inputs">
                            <div class="color-input-row">
                                <label>枠線色:</label>
                                <input type="color" id="shapeCustomColor" value="#FF0000" disabled>
                            </div>
                        </div>
                    </details>

                    <!-- 枠線の太さ選択（5段階プリセット） -->
                    <div class="shape-linewidth-panel-section">
                        <label>枠線の太さ:</label>
                        <div class="shape-linewidth-panel">
                            <button class="shape-linewidth-btn" data-linewidth="2" title="極細" disabled>2px</button>
                            <button class="shape-linewidth-btn" data-linewidth="3" title="細" disabled>3px</button>
                            <button class="shape-linewidth-btn active" data-linewidth="5" title="標準" disabled>5px</button>
                            <button class="shape-linewidth-btn" data-linewidth="7" title="太" disabled>7px</button>
                            <button class="shape-linewidth-btn" data-linewidth="10" title="極太" disabled>10px</button>
                        </div>
                    </div>

                    <p class="help-text">図形を追加するには、動画プレビュー上でドラッグしてください。<br>
                    「追加（継続）」：前の図形も表示<br>
                    「追加（新規）」：前の図形を非表示</p>

                    <div class="shape-buttons-row">
                        <button id="addShapeContinueBtn" class="btn" disabled>追加（継続）</button>
                        <button id="addShapeNewBtn" class="btn" disabled>追加（新規）</button>
                    </div>
                    <button id="addNoShapeBtn" class="btn" disabled>図形描画終了</button>

                    <!-- 図形リスト -->
                    <div id="shapeList" class="shape-list">
                        <p class="empty-message">図形が登録されていません</p>
                    </div>
                    </section>
                </div>

                <!-- 詳細テキストタブ -->
                <div class="tab-content" id="detailTab">
                    <section class="annotation-section">
                        <h2 class="sr-only">詳細テキスト</h2>

                    <!-- 時刻調整ボタン -->
                    <div class="time-adjust-controls">
                        <div class="time-adjust-row">
                            <button class="btn-tiny" data-adjust-detail="10" disabled>+10秒</button>
                            <button class="btn-tiny" data-adjust-detail="1" disabled>+1秒</button>
                            <button class="btn-tiny" data-adjust-detail="0.1" disabled>+0.1秒</button>
                            <button class="btn-tiny" id="syncDetailTime" disabled>現在位置</button>
                        </div>
                        <div class="time-adjust-row">
                            <button class="btn-tiny" data-adjust-detail="-10" disabled>-10秒</button>
                            <button class="btn-tiny" data-adjust-detail="-1" disabled>-1秒</button>
                            <button class="btn-tiny" data-adjust-detail="-0.1" disabled>-0.1秒</button>
                            <button class="btn-tiny" id="resetDetailTime" disabled>リセット</button>
                        </div>
                    </div>

                    <!-- フォント選択 -->
                    <div class="font-selection-section">
                        <label>フォント:</label>
                        <select id="detailFontSelect" disabled>
                            <option value="Noto Sans JP">Noto Sans JP（標準）</option>
                            <option value="M PLUS Rounded 1c">M PLUS Rounded 1c（丸ゴシック）</option>
                            <option value="Zen Kaku Gothic New">Zen Kaku Gothic New（角ゴシック）</option>
                        </select>
                    </div>

                    <!-- テキスト入力 -->
                    <input type="text" id="detailText" placeholder="詳細テキスト" disabled>

                    <!-- 配色プリセット -->
                    <div class="color-preset-section compact">
                        <label>配色:</label>
                        <div class="preset-buttons">
                            <button class="detail-preset-btn active" data-preset="explanation" data-text-color="#000000" data-bg-color="#FFFFFF" data-bg-opacity="1.0" data-text-align="left">説明</button>
                            <button class="detail-preset-btn" data-preset="point" data-text-color="#000000" data-bg-color="#FFE5E0" data-bg-opacity="1.0" data-text-align="left">要点</button>
                            <button class="detail-preset-btn" data-preset="caution" data-text-color="#000000" data-bg-color="#FFF9E6" data-bg-opacity="1.0" data-text-align="left">注意</button>
                            <button class="detail-preset-btn" id="detailCustomPresetBtn" data-preset="custom" data-text-color="#000000" data-bg-color="#FFFFFF" data-bg-opacity="1.0" data-text-align="left">登録</button>
                        </div>
                    </div>

                    <!-- カスタム設定（折りたたみ可能） -->
                    <details class="custom-color-section">
                        <summary>カスタム</summary>
                        <div class="custom-color-inputs">
                            <div class="color-input-row">
                                <label>文字色:</label>
                                <input type="color" id="detailCustomTextColor" value="#000000" disabled>
                            </div>
                            <div class="color-input-row">
                                <label>背景色:</label>
                                <input type="color" id="detailCustomBgColor" value="#FFFFFF" disabled>
                            </div>
                            <div class="color-input-row">
                                <label>透明度:</label>
                                <input type="range" id="detailBgOpacity" min="0" max="100" value="100" disabled>
                                <span id="detailBgOpacityValue">100%</span>
                            </div>
                            <div class="text-align-section">
                                <label>文字位置:</label>
                                <div class="text-align-buttons">
                                    <button class="detail-text-align-btn active" data-align="left" disabled>左</button>
                                    <button class="detail-text-align-btn" data-align="center" disabled>中央</button>
                                    <button class="detail-text-align-btn" data-align="right" disabled>右</button>
                                </div>
                            </div>
                            <button id="saveDetailCustomPresetBtn" class="btn-save-preset" disabled>📌 登録</button>
                        </div>
                    </details>

                    <div class="detail-button-row">
                        <button id="addDetailTextBtn" class="btn-compact" disabled>📌 追加</button>
                        <button id="addNoDetailTextBtn" class="btn-compact" disabled>詳細テキストなし</button>
                    </div>

                    <!-- 詳細テキストリスト -->
                    <div id="detailTextList" class="detail-text-list">
                        <p class="empty-message">詳細テキストが登録されていません</p>
                    </div>
                    </section>
                </div>

            </aside>

        </main>

        <!-- フッター: 抽出画像ギャラリー -->
        <footer class="gallery-footer">
            <div class="gallery-header">
                <h3>抽出画像ギャラリー</h3>
                <button id="clearAllImagesBtn" class="btn-clear-all" style="display: none;">🗑 すべてクリア</button>
            </div>
            <div id="imageGallery" class="image-gallery">
                <p class="empty-message">画像が抽出されていません</p>
            </div>
        </footer>

    </div>

    <!-- JavaScriptファイルの読み込み -->
    <!-- 定数ファイル（最初に読み込む） -->
    <script src="js/constants.js"></script>
    <!-- ユーティリティ -->
    <script src="js/utils.js"></script>
    <!-- 各モジュール -->
    <script src="js/fileHandler.js"></script>
    <script src="js/videoPlayer.js"></script>
    <script src="js/rangeSelector.js"></script>
    <script src="js/annotationManager.js"></script>
    <script src="js/shapeAnnotationManager.js"></script>
    <script src="js/detailTextManager.js"></script>
    <script src="js/arrowAnnotationManager.js"></script>
    <script src="js/frameExtractor.js"></script>
    <script src="js/videoTrimmer.js"></script>
    <script src="js/projectManager.js"></script>
    <!-- アプリ初期化（最後に読み込む） -->
    <script src="js/app.js"></script>
</body>
</html>

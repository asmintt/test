<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MovieFrameSnap Lite</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <!-- メインコンテナ -->
    <div class="container">

        <!-- メインコンテンツエリア -->
        <main class="main-content">

            <!-- 左サイドバー: コントロールパネル -->
            <aside class="sidebar">

                <!-- アプリ名 -->
                <div class="app-title">
                    <h1>MovieFrameSnap Lite</h1>
                </div>

                <!-- 1. プロジェクト選択（タブ式） -->
                <section class="control-section">
                    <h2>1. 開始</h2>

                    <!-- タブナビゲーション -->
                    <div class="start-tab-navigation">
                        <button class="start-tab-btn active" data-start-tab="new">📁 新規作成</button>
                        <button class="start-tab-btn" data-start-tab="open">📂 編集再開</button>
                    </div>

                    <!-- 新規作成タブ -->
                    <div class="start-tab-content active" id="newProjectTab">
                        <div class="file-input-area">
                            <input type="file" id="videoInput" accept="video/*" class="file-input">
                            <label for="videoInput" class="file-label">
                                ファイルを選択 / ドロップ
                            </label>
                        </div>
                        <p id="fileName" class="file-name"></p>
                    </div>

                    <!-- 既存を開くタブ -->
                    <div class="start-tab-content" id="openProjectTab">
                        <button id="loadProjectBtn" class="btn-primary">プロジェクトを開く</button>
                        <p class="help-text">保存済みのプロジェクトフォルダを選択して、編集を再開できます</p>
                        <button id="saveProjectBtn" class="btn" disabled>💾 プロジェクトを保存</button>
                    </div>
                </section>


                <!-- 2. 動画の範囲を指定 -->
                <section class="control-section">
                    <details open>
                        <summary><h2>2. 動画の範囲を指定</h2></summary>
                        <div class="range-controls">
                            <!-- 範囲スライダー -->
                            <div class="range-slider">
                                <input type="range" id="startSlider" min="0" max="100" value="0" step="0.1" disabled>
                                <input type="range" id="endSlider" min="0" max="100" value="100" step="0.1" disabled>
                            </div>

                            <!-- 開始時刻（1行） -->
                            <div class="time-input-group compact-row">
                                <label>開始:</label>
                                <button id="setStartBtn" class="btn-tiny" disabled>現在位置</button>
                                <input type="text" id="startTime" value="00:00:00" disabled>
                            </div>

                            <!-- 終了時刻（1行） -->
                            <div class="time-input-group compact-row">
                                <label>終了:</label>
                                <button id="setEndBtn" class="btn-tiny" disabled>現在位置</button>
                                <input type="text" id="endTime" value="00:00:00" disabled>
                            </div>

                            <!-- 範囲情報と操作ボタン（2行） -->
                            <div class="range-info-section">
                                <div class="range-display-box">
                                    <span class="range-info-text">選択範囲: <span id="rangeDisplay">00:00:00</span></span>
                                </div>
                                <div class="range-action-buttons">
                                    <button id="playRangeBtn" class="btn-tiny" disabled>再生</button>
                                    <button id="resetRangeBtn" class="btn-tiny" disabled>全範囲再生</button>
                                </div>
                            </div>
                        </div>
                    </details>
                </section>

                <!-- 動画設定 -->
                <section class="control-section">
                    <h2>動画設定</h2>
                    <div class="video-settings">
                        <!-- タイトル -->
                        <div class="setting-row">
                            <label>タイトル:</label>
                            <input type="text" id="projectTitle" placeholder="動画ファイル名から自動入力" disabled>
                        </div>

                        <!-- 再生速度 -->
                        <div class="setting-row">
                            <label>再生速度:</label>
                            <input type="number" id="playbackSpeed" value="1.0" min="0.25" max="4.0" step="0.25" disabled>
                            <span>×</span>
                        </div>

                        <!-- オプション（1行） -->
                        <div class="checkbox-row">
                            <label class="checkbox-label">
                                <input type="checkbox" id="includeAudio" checked disabled>
                                音声付き
                            </label>
                            <label class="checkbox-label">
                                <input type="checkbox" id="includeVideoAnnotations" checked disabled>
                                図形・注釈付き
                            </label>
                        </div>

                        <!-- ダウンロードボタン -->
                        <button id="downloadVideoBtn" class="btn-download-video" disabled>
                            ⬇ トリミング動画をダウンロード
                        </button>
                    </div>
                </section>

                <!-- 3. 画像抽出（手動） -->
                <section class="control-section">
                    <h2>3. 画像抽出（手動）</h2>
                    <div class="extract-controls">
                        <!-- オプション -->
                        <label class="checkbox-label">
                            <input type="checkbox" id="includeTimestamp" checked>
                            タイムスタンプを表示
                        </label>
                        <label class="checkbox-label">
                            <input type="checkbox" id="includeShapes">
                            図形アノテーションを含める
                        </label>
                        <label class="checkbox-label">
                            <input type="checkbox" id="includeTextAnnotations">
                            テキスト注釈を含める
                        </label>

                        <!-- 抽出ボタン -->
                        <button id="extractFrameBtn" class="btn-primary" disabled>
                            📸 現在位置の画像を抽出
                        </button>
                    </div>
                </section>

            </aside>

            <!-- 中央: 動画プレビューエリア -->
            <div class="video-area">

                <!-- 動画プレビューと時刻調整ボタン（固定） -->
                <div class="video-preview-sticky-container">
                    <!-- 動画プレビュー -->
                    <div class="video-wrapper">
                        <div class="video-container">
                            <video id="videoPlayer" controls></video>
                            <canvas id="annotationCanvas"></canvas>
                        </div>
                        <div id="textAnnotationDisplay" class="text-annotation-display"></div>
                        <div id="detailTextDisplay" class="detail-text-display"></div>
                    </div>

                    <!-- 再生時間調整ボタン -->
                    <div class="video-time-controls">
                        <span class="video-time-label">再生位置:</span>
                        <button class="time-adjust-btn" data-video-adjust="10" disabled>+10秒</button>
                        <button class="time-adjust-btn" data-video-adjust="1" disabled>+1秒</button>
                        <button class="time-adjust-btn" data-video-adjust="0.1" disabled>+0.1秒</button>
                        <button class="time-adjust-btn" data-video-adjust="-0.1" disabled>-0.1秒</button>
                        <button class="time-adjust-btn" data-video-adjust="-1" disabled>-1秒</button>
                        <button class="time-adjust-btn" data-video-adjust="-10" disabled>-10秒</button>
                    </div>
                </div>

                <!-- 履歴エリア（3分割） -->
                <div class="history-area">
                    <div class="history-column">
                        <h3>図形履歴</h3>
                        <div id="shapeHistoryList" class="history-list">
                            <p class="empty-message">図形が登録されていません</p>
                        </div>
                    </div>
                    <div class="history-column">
                        <h3>注釈履歴</h3>
                        <div id="annotationHistoryList" class="history-list">
                            <p class="empty-message">注釈が登録されていません</p>
                        </div>
                    </div>
                    <div class="history-column">
                        <h3>詳細履歴</h3>
                        <div id="detailHistoryList" class="history-list">
                            <p class="empty-message">詳細が登録されていません</p>
                        </div>
                    </div>
                </div>

            </div>

            <!-- 右サイドバー: 注釈エリア -->
            <aside class="sidebar-right">

                <section class="unified-annotation-section">

                    <!-- 図形 -->
                    <div class="shape-section">
                        <div class="section-header-with-presets">
                            <h3>図形</h3>
                            <div class="preset-buttons-inline">
                                <button class="preset-btn shape-preset-btn active" data-preset="explanation" data-text-color="#000000" data-bg-color="#FFFFFF">説明</button>
                                <button class="preset-btn shape-preset-btn" data-preset="point" data-text-color="#000000" data-bg-color="#FF6B6B">要点</button>
                                <button class="preset-btn shape-preset-btn" data-preset="caution" data-text-color="#000000" data-bg-color="#FFD54F">注意</button>
                                <button class="preset-btn shape-preset-btn" id="shapeCustomPresetBtn" data-preset="custom" data-text-color="#000000" data-bg-color="#FFFFFF" title="Wクリックで設定画面に">登録</button>
                            </div>
                        </div>

                        <!-- 1行目: 直線、四角、テキスト付き矢印 -->
                        <div class="shape-selector">
                            <button class="shape-btn" data-shape="line">直線</button>
                            <button class="shape-btn" data-shape="rectangle">四角</button>
                            <button class="shape-btn direction-arrow-btn direction-arrow-left" data-shape="arrow-left">⬅ 左</button>
                            <button class="shape-btn direction-arrow-btn direction-arrow-right" data-shape="arrow-right">右 ➡</button>
                        </div>

                        <!-- 2行目: 記号のみ矢印（4方向） -->
                        <div class="shape-selector">
                            <button class="shape-btn" data-shape="arrow-left">⬅</button>
                            <button class="shape-btn" data-shape="arrow-right">➡</button>
                            <button class="shape-btn" data-shape="arrow-up">⬆</button>
                            <button class="shape-btn" data-shape="arrow-down">⬇</button>
                        </div>

                        <!-- 3行目: 操作ボタン -->
                        <div class="shape-selector">
                            <button class="shape-btn" data-shape="erase">消去</button>
                            <button class="shape-btn" data-shape="none">選択解除</button>
                        </div>

                        <!-- 枠線の太さ選択 -->
                        <div class="shape-linewidth-panel-section">
                            <label>枠線の太さ:</label>
                            <div class="shape-linewidth-panel-compact">
                                <button class="shape-linewidth-btn-compact active" data-linewidth="1" disabled>1</button>
                                <button class="shape-linewidth-btn-compact" data-linewidth="3" disabled>3</button>
                                <button class="shape-linewidth-btn-compact" data-linewidth="5" disabled>5</button>
                                <input type="number" id="customLineWidth" class="custom-linewidth-input" min="1" max="50" value="1" disabled>
                            </div>
                        </div>

                        <!-- 通常モード用ボタン -->
                        <div class="shape-buttons-row" id="normalModeButtons">
                            <button id="addShapeContinueBtn" class="btn-compact btn-add-to-history" disabled>続けて追加</button>
                            <button id="addShapeNewBtn" class="btn-compact btn-add-to-history" disabled>新規</button>
                            <button id="addNoShapeBtn" class="btn-compact" disabled>表示終了</button>
                        </div>

                        <!-- 修正モード用ボタン（最初は非表示） -->
                        <div class="shape-buttons-row" id="editModeButtons" style="display: none;">
                            <button id="confirmEditBtn" class="btn-compact">修正更新</button>
                            <button id="cancelEditBtn" class="btn-compact">修正破棄</button>
                        </div>
                    </div>

                    <!-- 注釈 -->
                    <div class="annotation-section">
                        <div class="section-header-with-presets">
                            <h3>注釈</h3>
                            <div class="preset-buttons-inline">
                                <button class="preset-btn annotation-preset-btn" data-preset="explanation" data-text-color="#000000" data-bg-color="#FFFFFF">説明</button>
                                <button class="preset-btn annotation-preset-btn" data-preset="point" data-text-color="#000000" data-bg-color="#FF6B6B">要点</button>
                                <button class="preset-btn annotation-preset-btn" data-preset="caution" data-text-color="#000000" data-bg-color="#FFD54F">注意</button>
                                <button class="preset-btn annotation-preset-btn" id="annotationCustomPresetBtn" data-preset="custom" data-text-color="#000000" data-bg-color="#FFFFFF" title="Wクリックで設定画面に">登録</button>
                            </div>
                        </div>

                        <!-- フォント選択（1行圧縮） -->
                        <div class="font-selection-section compact">
                            <label>フォント:</label>
                            <select id="textFontSelect" disabled>
                                <option value="Noto Sans JP">角ゴシック（太）</option>
                                <option value="M PLUS Rounded 1c">丸ゴシック</option>
                                <option value="Noto Serif JP">明朝体</option>
                                <option value="Klee One">手書き風</option>
                                <option value="Yusei Magic">ポップ体</option>
                            </select>
                        </div>

                        <!-- 文字配置選択 -->
                        <div class="text-align-section">
                            <label>文字配置:</label>
                            <button class="text-align-btn active" data-align="left" disabled>左</button>
                            <button class="text-align-btn" data-align="center" disabled>中央</button>
                            <button class="text-align-btn" data-align="right" disabled>右</button>
                        </div>

                        <!-- テキスト入力 -->
                        <div class="two-line-input-section compact">
                            <div class="checkbox-help-row">
                                <input type="checkbox" id="annotationText1UseSeq" class="seq-checkbox" disabled>
                                <p class="help-text-small">連番を自動採番</p>
                            </div>
                            <input type="text" id="annotationText1" placeholder="テキスト（２０文字まで）" maxlength="20" disabled>
                        </div>

                        <button id="addAnnotationBtn" class="btn compact btn-add-to-history" disabled>注釈を追加</button>
                        <button id="addBlankAnnotationBtn" class="btn compact" disabled>表示終了</button>
                    </div>

                    <!-- 詳細テキスト -->
                    <div class="detail-section">
                        <h3>詳細テキスト</h3>

                        <!-- フォント選択 -->
                        <div class="font-selection-section">
                            <label>フォント:</label>
                            <select id="detailFontSelect" disabled>
                                <option value="Noto Sans JP">角ゴシック（太）</option>
                                <option value="M PLUS Rounded 1c">丸ゴシック</option>
                                <option value="Noto Serif JP">明朝体</option>
                                <option value="Klee One">手書き風</option>
                                <option value="Yusei Magic">ポップ体</option>
                            </select>
                        </div>

                        <!-- 文字配置選択 -->
                        <div class="text-align-section">
                            <label>文字配置:</label>
                            <button class="detail-text-align-btn active" data-align="left" disabled>左</button>
                            <button class="detail-text-align-btn" data-align="center" disabled>中央</button>
                            <button class="detail-text-align-btn" data-align="right" disabled>右</button>
                        </div>

                        <!-- テキスト入力 -->
                        <input type="text" id="detailText" placeholder="詳細テキスト" disabled>

                        <div class="detail-button-row">
                            <button id="addDetailTextBtn" class="btn-compact btn-add-to-history" disabled>詳細テキストを追加</button>
                            <button id="addNoDetailTextBtn" class="btn-compact" disabled>表示終了</button>
                        </div>
                    </div>

                </section>

            </aside>

        </main>

        <!-- フッター: 抽出画像ギャラリー -->
        <footer class="gallery-footer">
            <div class="gallery-header">
                <h3>抽出画像ギャラリー</h3>
                <button id="clearAllImagesBtn" class="btn-clear-all" style="display: none;">🗑 すべてクリア</button>
            </div>
            <div id="imageGallery" class="image-gallery">
                <p class="empty-message">画像が抽出されていません</p>
            </div>
        </footer>

    </div>

    <!-- カスタム設定モーダル -->
    <div id="customSettingsModal" class="modal-overlay" style="display: none;">
        <div class="modal-content">
            <div class="modal-header">
                <h3 id="modalTitle">カスタム設定</h3>
                <button class="modal-close-btn">&times;</button>
            </div>
            <div class="modal-body" id="modalBody">
                <!-- 動的にコンテンツを挿入 -->
            </div>
        </div>
    </div>

    <!-- JavaScriptファイルの読み込み -->
    <!-- 定数ファイル（最初に読み込む） -->
    <script src="js/constants.js"></script>
    <!-- ユーティリティ -->
    <script src="js/utils.js"></script>
    <!-- 各モジュール -->
    <script src="js/fileHandler.js"></script>
    <script src="js/videoPlayer.js"></script>
    <script src="js/rangeSelector.js"></script>
    <script src="js/annotationManager.js"></script>
    <script src="js/shapeAnnotationManager.js"></script>
    <script src="js/detailTextManager.js"></script>
    <script src="js/frameExtractor.js"></script>
    <script src="js/videoTrimmer.js"></script>
    <script src="js/projectManager.js"></script>
    <!-- アプリ初期化（最後に読み込む） -->
    <script src="js/app.js"></script>
</body>
</html>

# MovieFrameSnap Lite

動画から手動でフレームを抽出し、注釈を追加できるデスクトップアプリケーション

## 機能

### 1. 動画ファイル選択
- ファイル選択ダイアログまたはドラッグ&ドロップで動画を読み込み
- 対応形式: MP4, MOV, AVI, WebM など、一般的な動画形式

### 2. 動画範囲の指定
- スライダーまたは手動入力で開始・終了時刻を設定
- 現在の再生位置から範囲を設定可能
- 選択範囲のみを再生
- 範囲をリセット（全体を選択）

### 3. 画像抽出（手動）
- 現在の再生位置から1枚ずつ画像を抽出
- タイムスタンプの表示/非表示
- 図形アノテーションを含めて抽出
- テキスト注釈を含めて抽出
- 抽出画像はギャラリーに表示され、個別にダウンロード可能

### 4. テキスト注釈
- 特定の時刻にテキスト注釈を追加
- 文字色と背景色をカスタマイズ
- 注釈なし（時刻のみ）の登録も可能
- 注釈をクリックしてその時刻にジャンプ
- **注釈の修正**: 既存の注釈を修正可能
- **注釈の削除**: 不要な注釈を削除
- **降順表示**: 最新の注釈が上に表示される

### 5. 図形アノテーション
- 動画上に図形を描画（四角、矢印）
- マウスドラッグで描画後、「追加」ボタンで確定
- 矢印は → 記号で表示（プレビューとダウンロード動画で同じ表示）
- 図形の色を選択
- **図形の修正**: 既存の図形を修正可能
- **図形の削除**: 不要な図形を削除
- **図形描画終了**: 「図形描画終了」ボタンで図形なしの時刻を記録
- **降順表示**: 最新の図形が上に表示される

### 6. 動画トリミング
- 選択範囲の動画を切り出してダウンロード
- 音声の含める/含めないを選択
- テキスト注釈を動画に焼き込むか選択
- FFmpegを使用した高品質な処理

## インストール

### 必要要件
- Node.js (v14以上)
- macOS（現在の対応環境）

### セットアップ手順

1. リポジトリをクローン

```bash
git clone https://github.com/asmintt/test.git
cd test
```

2. 依存パッケージをインストール

```bash
npm install
```

## 起動方法

### 開発モード

```bash
npm start
```

### アプリケーションをビルド

```bash
npm run build
```

ビルド後、`dist/mac-arm64/MovieFrameSnap Lite.app` が生成されます。
このアプリをApplicationsフォルダにコピーして使用してください。

```bash
cp -R "dist/mac-arm64/MovieFrameSnap Lite.app" /Applications/
```

## 使い方

### 基本的な流れ

1. **動画を読み込む**
   - 左サイドバーの「ファイルを選択 / ドロップ」エリアをクリックして動画ファイルを選択
   - または動画ファイルをドラッグ&ドロップ

2. **範囲を指定（オプション）**
   - 必要に応じて、動画の開始・終了時刻を設定
   - 「範囲を再生」ボタンで確認

3. **テキスト注釈を追加（オプション）**
   - 右サイドバー「テキスト注釈」セクションでテキストを入力
   - 文字色と背景色を選択（カラーピッカー）
   - 「追加」ボタンをクリック
   - 注釈なしの時刻を記録する場合は「注釈なし」ボタン
   - 修正する場合は注釈リストの「修正」ボタンをクリック

4. **図形アノテーションを追加（オプション）**
   - 右サイドバー「図形アノテーション」セクションで図形を選択（四角、矢印）
   - 枠線色を選択
   - 動画プレビュー上でマウスドラッグして図形を描画
   - 「追加」ボタンをクリックして確定
   - 図形描画を終了する時刻を記録する場合は「図形描画終了」ボタン
   - 修正する場合は図形リストの「修正」ボタンをクリック

5. **画像を抽出**
   - 動画を再生して好きな位置で一時停止
   - 左サイドバーで抽出オプションを選択
     - タイムスタンプを表示
     - 図形アノテーションを含める
     - テキスト注釈を含める
   - 「📸 現在位置の画像を抽出」ボタンをクリック
   - 抽出した画像は下のギャラリーに表示されます

6. **画像をダウンロード**
   - ギャラリーの各画像の「保存」ボタンをクリック

7. **動画をトリミング（オプション）**
   - 範囲を指定した後、中央の動画コントロールエリアで設定
     - タイトルを入力
     - 再生速度を調整
     - 音声を含むかチェック
     - テキスト注釈を含むかチェック
   - 「⬇ トリミング動画をダウンロード」ボタンをクリック

### 注釈の表示タイミング

- **テキスト注釈**: 登録した時刻から次の注釈（または「注釈なし」）まで継続表示
- **図形アノテーション**: 登録した時刻から次の図形（または「図形描画終了」）まで継続表示
- 同じ時刻に複数の図形を登録すると同時に表示される

## プロジェクト構成

```
MovieFrameSnap-Lite/
├── main.js                 # Electronメインプロセス (500行)
├── package.json            # プロジェクト設定 (39行)
├── src/
│   ├── index.html          # メインHTML (226行)
│   ├── style.css           # スタイルシート (676行)
│   ├── preload.js          # Electronプリロードスクリプト (38行)
│   └── js/
│       ├── utils.js                    # 共通ユーティリティ関数 (116行)
│       ├── fileHandler.js              # ファイル選択・読み込み (130行)
│       ├── videoPlayer.js              # 動画再生制御 (191行)
│       ├── rangeSelector.js            # 範囲選択 (348行)
│       ├── annotationManager.js        # テキスト注釈管理 (314行)
│       ├── shapeAnnotationManager.js   # 図形アノテーション管理 (574行)
│       ├── frameExtractor.js           # フレーム抽出 (315行)
│       ├── videoTrimmer.js             # 動画トリミング (174行)
│       └── app.js                      # アプリケーション初期化 (176行)
└── README.md               # このファイル (233行)

総コード行数: 約4,050行
```

## 開発者向け情報

### コードの構成

- **モジュール化**: 各機能は独立したJavaScriptファイルに分割
- **クラスベース**: 各モジュールはクラスとして実装
- **グローバルインスタンス**: 各クラスはグローバル変数として1つだけインスタンス化
- **コールバック**: モジュール間の通信はコールバック関数で実現

### 技術スタック

- **Electron**: デスクトップアプリケーションフレームワーク
- **FFmpeg**: 動画処理（fluent-ffmpeg, ffmpeg-static）
- **Canvas API**: 画像処理と図形描画
- **HTML5 Video**: 動画再生

### カスタマイズ

各モジュールは独立しているため、機能の追加や変更が容易です。
例えば、新しい図形タイプを追加する場合は `shapeAnnotationManager.js` の `drawShape` メソッドを編集してください。

### ビルドスクリプト

```json
{
  "start": "electron .",
  "build": "npm run clean && electron-builder",
  "clean": "rm -rf dist"
}
```

## トラブルシューティング

### 動画が再生されない
- 対応していない形式の可能性があります
- 別の形式（MP4など）に変換してお試しください

### トリミングが動作しない
- FFmpegが正しくインストールされていない可能性があります
- `npm install` を再実行してください

### 画像が抽出されない
- 動画が正しく読み込まれているか確認してください
- 開発者ツール（View → Toggle Developer Tools）でコンソールのエラーを確認してください

### レイアウトが崩れる（MacBook Airなど小さい画面）
- アプリウィンドウを最大化してください
- 開発者ツールを閉じると表示領域が広がります

### 図形が保存されない
- 図形を描画した後、必ず「追加」ボタンをクリックしてください
- 開発者ツールのコンソールでエラーメッセージを確認してください

## 既知の問題

- MacBook Airなど小さい画面では、開発者ツールを開くと3カラムレイアウトが縦スクロールになる
- アプリは必ずApplicationsフォルダから起動してください（distフォルダから起動するとレイアウトが崩れます）

## ライセンス

このプロジェクトは個人利用および学習目的で自由に使用できます。

## 作者

Created with Claude Code

🤖 Generated with [Claude Code](https://claude.com/claude-code)

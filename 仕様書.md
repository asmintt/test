---

MovieFrameSnap Lite UI/UX 改善 プロジェクト修正手順書

【実装順序】

STEP 0 → STEP 4 → STEP 1 → STEP 2 → STEP 3

---

【STEP 0】詳細テキスト機能の緊急修正（最優先）

目的: 壊れた詳細テキスト機能を修復

0-1. detailTextManager.js の修正

修正内容:

- .detail-preset-btn → .preset-btn に変更
- 削除されたカスタム要素の参照を削除
  - detailCustomTextColor
  - detailCustomBgColor
  - detailBgOpacity
  - detailBgOpacityValue
  - .detail-text-align-btn
  - saveDetailCustomPresetBtn
  - detailCustomPresetBtn
- 共通プリセットボタンのイベントハンドラを追加
- 統一カスタム設定のイベントハンドラを追加（annotationManager.js と同様）

0-2. 動作確認

- 詳細テキスト追加ボタンが動作するか
- 共通配色ボタンで詳細テキストの色が変わるか
- エラーが出ていないか（ブラウザコンソール確認）
- アプリが正常に起動するか

---

【STEP 4】方向矢印の仕様変更

目的: 左右矢印ボタンのデザインを変更（矢印の先にテキストを置かない）

4-1. HTML の修正 (index.html)

現在の方向矢印セクション（line 304-336 付近）を削除

4-2. 図形セクションに方向矢印ボタンを追加

追加位置: 図形セクション（line 234-244 付近）の図形選択ボタンエリア

HTML イメージ:

  <div class="shape-selector">
      <button class="shape-btn" data-shape="line">直線</button>
      <button class="shape-btn" data-shape="rectangle">四角</button>
      <button class="shape-btn" data-shape="erase">消去</button>
      <button class="shape-btn" data-shape="none">解除</button>
  </div>
  <div class="shape-selector">
      <button class="direction-arrow-btn direction-arrow-left" data-direction="left">⬅ 左</button>
      <button class="direction-arrow-btn direction-arrow-right" data-direction="right">右 ➡</button>
  </div>

仕様:

- 左矢印: 青い背景色 + ⬅ 左 （矢印が先、テキストが後）
- 右矢印: 橙の背景色 + 右 ➡ （テキストが先、矢印が後）
- 図形描画と同じ太い矢印記号を使用
- 枠線の太さ設定と連動
- 枠線色で色を変更可能、初期値はボタン背景色と一致

4-3. CSS の追加 (style.css)

/_ 方向矢印ボタン _/
.direction-arrow-btn {
padding: 10px 15px;
font-size: 1.1rem;
font-weight: 600;
border: 2px solid transparent;
border-radius: 6px;
cursor: pointer;
transition: all 0.2s;
}

.direction-arrow-left {
background-color: #1976D2; /_ 青 _/
color: white;
}

.direction-arrow-left:hover {
background-color: #1565C0;
}

.direction-arrow-right {
background-color: #FF9800; /_ 橙 _/
color: white;
}

.direction-arrow-right:hover {
background-color: #F57C00;
}

.direction-arrow-btn.active {
border-color: #2c5282;
box-shadow: 0 0 0 3px rgba(44, 82, 130, 0.2);
}

4-4. JavaScript の修正 (shapeAnnotationManager.js)

- 方向矢印ボタンのイベントハンドラを追加
- 図形タイプ arrow-left, arrow-right として扱う
- 枠線の太さ設定と連動させる
- 枠線色で背景色を変更可能にする（初期値: 左=青、右=橙）

4-5. 動作確認

- 左右矢印ボタンが表示されているか
- ボタンクリックで矢印モードに入るか
- 枠線の太さと連動しているか
- 色が正しく設定されているか
- 矢印が動画プレビュー上に描画できるか

---

【STEP 1】動画プレビュー下のコントロールを左サイドバーに移動

目的: タイトル、再生速度、ダウンロードボタンを左サイドバーに集約

1-1. HTML の修正 (index.html)

移動元: 動画プレビュー下（line 157-178 付近）

  <!-- 動画コントロール -->
  <div class="video-controls">
      <div class="control-row">
          <label>タイトル:</label>
          <input type="text" id="projectTitle" placeholder="動画ファイル名から自動入力" disabled>
      </div>
      <div class="control-row">
          <label>再生速度:</label>
          <input type="number" id="playbackSpeed" value="1.0" min="0.25" max="4.0" step="0.25" disabled>
          <span>×</span>
          <label class="checkbox-label" style="margin-left: 15px;">
              <input type="checkbox" id="includeAudio" checked disabled>
              音声を含む
          </label>
          <label class="checkbox-label">
              <input type="checkbox" id="includeVideoAnnotations" checked disabled>
              テキスト注釈を含む
          </label>
      </div>
      <button id="downloadVideoBtn" class="btn-primary" disabled>
          ⬇ トリミング動画をダウンロード
      </button>
  </div>

移動先: 左サイドバー「3. 画像抽出（手動）」セクション（line 116-139 付近）の位置

1-2. セクション番号と見出しの変更

- 「3. 画像抽出（手動）」→ 「3. 動画設定」に変更
- 内容をタイトル・再生速度・ダウンロードボタンに差し替え

1-3. CSS の調整

左サイドバーの幅（現在 200px）に収まるよう調整:
.sidebar input[type="text"],
.sidebar input[type="number"] {
width: 100%;
font-size: 0.8rem;
padding: 6px 8px;
}

.sidebar .control-row {
margin-bottom: 10px;
}

.sidebar .checkbox-label {
font-size: 0.75rem;
}

1-4. 動作確認

- タイトル入力欄が動作するか
- 再生速度設定が動作するか
- チェックボックスが動作するか
- ダウンロードボタンが動作するか
- レイアウトが崩れていないか

---

【STEP 2】動画プレビュー下に注釈・図形の履歴表示エリアを作成

目的: タブ切り替えなしで履歴を確認できるようにする

2-1. HTML の修正 (index.html)

動画プレビュー下（移動したコントロールの跡地、line 157 付近）に新しいセクションを追加:

  <!-- 動画プレビュー -->
  <div class="video-wrapper">
      <div class="video-container">
          <video id="videoPlayer" controls></video>
          <canvas id="annotationCanvas"></canvas>
      </div>
      <div id="textAnnotationDisplay" class="text-annotation-display"></div>
      <div id="detailTextDisplay" class="detail-text-display"></div>
  </div>

  <!-- 登録履歴エリア（新規追加） -->
  <div class="annotation-history-area">
      <h3>登録履歴</h3>
      <div class="history-tabs">
          <button class="history-tab-btn active" data-history="shapes">図形</button>
          <button class="history-tab-btn" data-history="annotations">注釈</button>
      </div>
      <div class="history-content">
          <div id="shapesHistory" class="history-list active"></div>
          <div id="annotationsHistory" class="history-list"></div>
      </div>
  </div>

2-2. CSS の追加 (style.css)

/_ 登録履歴エリア _/
.annotation-history-area {
background: white;
border-radius: 8px;
padding: 15px;
margin-top: 15px;
box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
}

.annotation-history-area h3 {
font-size: 0.9rem;
color: #2c5282;
margin-bottom: 10px;
font-weight: 600;
}

/_ 履歴タブ _/
.history-tabs {
display: flex;
gap: 10px;
margin-bottom: 12px;
border-bottom: 2px solid #e0e0e0;
}

.history-tab-btn {
padding: 8px 16px;
background: transparent;
border: none;
border-bottom: 3px solid transparent;
color: #666;
font-size: 0.85rem;
font-weight: 600;
cursor: pointer;
transition: all 0.3s;
margin-bottom: -2px;
}

.history-tab-btn:hover {
color: #2c5282;
}

.history-tab-btn.active {
color: #2c5282;
border-bottom-color: #2c5282;
}

/_ 履歴コンテンツ _/
.history-content {
max-height: 250px; /_ MacBook Air で収まる高さ _/
overflow-y: auto;
}

.history-list {
display: none;
}

.history-list.active {
display: block;
}

2-3. JavaScript の修正

app.js または新規ファイル (historyManager.js) を作成:

// 履歴タブの切り替え
const historyTabButtons = document.querySelectorAll('.history-tab-btn');
const historyLists = document.querySelectorAll('.history-list');

historyTabButtons.forEach(button => {
button.addEventListener('click', () => {
const historyType = button.getAttribute('data-history');

          // タブのアクティブ状態を更新
          historyTabButtons.forEach(btn => btn.classList.remove('active'));
          button.classList.add('active');

          // リストの表示を切り替え
          historyLists.forEach(list => list.classList.remove('active'));
          if (historyType === 'shapes') {
              document.getElementById('shapesHistory').classList.add('active');
          } else if (historyType === 'annotations') {
              document.getElementById('annotationsHistory').classList.add('active');
          }
      });

});

shapeAnnotationManager.js の修正:

- this.shapeList = document.getElementById('shapeList'); の参照先を変更
- または、updateShapeList()メソッド内で両方のリスト（右サイドバー + 履歴エリア）を更新

annotationManager.js の修正:

- this.annotationList = document.getElementById('annotationList'); の参照先を変更
- または、renderAnnotationList()メソッド内で両方のリスト（右サイドバー + 履歴エリア）を更新

2-4. 動作確認

- 図形リストが履歴エリアに表示されるか
- 注釈リストが履歴エリアに表示されるか
- タブ切り替えが動作するか
- スクロールが動作するか
- MacBook Air の縦幅内に収まっているか
- 右サイドバーのリストも正常に動作するか

---

【STEP 3】「画像抽出（手動）」を抽出画像ギャラリーエリアに移動

目的: 画像抽出機能をギャラリーと同じエリアに配置

3-1. HTML の修正 (index.html)

移動元: 左サイドバー「3. 画像抽出（手動）」（STEP 1 で「3. 動画設定」に変更したため、元のコードを使用）

元のコード:

  <section class="control-section">
      <h2>3. 画像抽出（手動）</h2>
      <div class="extract-controls">
          <label class="checkbox-label">
              <input type="checkbox" id="includeTimestamp" checked>
              タイムスタンプを表示
          </label>
          <label class="checkbox-label">
              <input type="checkbox" id="includeShapes">
              図形アノテーションを含める
          </label>
          <label class="checkbox-label">
              <input type="checkbox" id="includeTextAnnotations">
              テキスト注釈を含める
          </label>
          <button id="extractFrameBtn" class="btn-primary" disabled>
              📸 現在位置の画像を抽出
          </button>
      </div>
  </section>

移動先: 抽出画像ギャラリーエリア（line 403-411 付近）のヘッダー部分

3-2. レイアウト変更

横長レイアウトで配置:

  <footer class="gallery-footer">
      <div class="gallery-header">
          <h3>抽出画像ギャラリー</h3>

          <!-- 画像抽出コントロール（横長レイアウト） -->
          <div class="gallery-controls">
              <label class="checkbox-label-inline">
                  <input type="checkbox" id="includeTimestamp" checked>
                  タイムスタンプ
              </label>
              <label class="checkbox-label-inline">
                  <input type="checkbox" id="includeShapes">
                  図形
              </label>
              <label class="checkbox-label-inline">
                  <input type="checkbox" id="includeTextAnnotations">
                  注釈
              </label>
              <button id="extractFrameBtn" class="btn-primary btn-compact" disabled>
                  📸 抽出
              </button>
          </div>

          <button id="clearAllImagesBtn" class="btn-clear-all" style="display: none;">🗑 すべてクリア</button>
      </div>
      <div id="imageGallery" class="image-gallery">
          <p class="empty-message">画像が抽出されていません</p>
      </div>

  </footer>

3-3. CSS の調整

/_ ギャラリーヘッダー _/
.gallery-header {
display: flex;
justify-content: space-between;
align-items: center;
margin-bottom: 15px;
gap: 20px;
}

/_ 画像抽出コントロール（横長） _/
.gallery-controls {
display: flex;
gap: 15px;
align-items: center;
flex: 1;
}

.checkbox-label-inline {
display: flex;
align-items: center;
gap: 5px;
font-size: 0.85rem;
color: #555;
white-space: nowrap;
}

.checkbox-label-inline input[type="checkbox"] {
margin: 0;
}

.btn-compact {
padding: 8px 16px;
font-size: 0.85rem;
}

3-4. 動作確認

- チェックボックスが横並びで表示されているか
- 抽出ボタンが動作するか
- レイアウトが崩れていないか
- ギャラリーエリア全体のバランスが良いか

---

【STEP 全体】全体確認

全体-1. 機能確認チェックリスト

基本機能:

- 動画読み込みが正常に動作するか
- 動画再生・一時停止が動作するか
- シークバーが動作するか

統合機能:

- 時刻調整ボタンが全てのセクションで動作するか
- 共通配色ボタンが図形・注釈・詳細テキストで動作するか
- 統一カスタム設定が動作するか
- 「登録」ボタンのダブルクリックでカスタム設定が開くか

各マネージャー:

- 図形追加が動作するか（直線・四角・方向矢印）
- 注釈追加が動作するか
- 詳細テキスト追加が動作するか
- 履歴エリアに正しく表示されるか

新機能:

- 方向矢印ボタン（左・右）が動作するか
- 枠線の太さと連動しているか
- 動画設定（タイトル・再生速度）が動作するか
- 画像抽出がギャラリーエリアから動作するか
- 動画ダウンロードが動作するか

全体-2. レイアウト確認

- MacBook Air の縦幅内に収まっているか
- 縦スクロールが必要な箇所で正しく動作するか
- 左サイドバーの幅（200px）に収まっているか
- 右サイドバーの幅（400px）に収まっているか
- 動画プレビューエリアが適切なサイズか
- ギャラリーエリアのレイアウトが崩れていないか

全体-3. エラー確認

- ブラウザコンソールにエラーが出ていないか
- 警告が出ていないか
- 動作が重くないか

---

【重要】実装時の注意事項

1. 実装順序を厳守

- STEP 0 → STEP 4 → STEP 1 → STEP 2 → STEP 3 の順で実施
- 各 STEP には依存関係があるため、順序を変えないこと

2. 各 STEP 完了後の確認

- 必ず動作確認を実施してから次の STEP に進む
- エラーが出たらその場で修正

3. コミットのタイミング

- 各 STEP 完了後にコミット推奨
- コミットメッセージ例:
  - fix: 詳細テキスト機能の修復 (STEP 0)
  - feat: 方向矢印ボタンの仕様変更 (STEP 4)
  - refactor: 動画コントロールを左サイドバーに移動 (STEP 1)
  - feat: 履歴表示エリアを追加 (STEP 2)
  - refactor: 画像抽出をギャラリーエリアに移動 (STEP 3)

4. テスト動画の準備

- 動作確認用の短い動画（10-30 秒程度）を用意しておく
- 図形・注釈・詳細テキストを複数登録して履歴エリアのスクロールを確認

5. バックアップ

- 実装開始前に現在の状態をコミットまたはバックアップ
- 万が一の場合に戻れるようにしておく

---

以上が完全版の手順書です。STEP 0 から実装を開始してよろしいでしょうか？

─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────

> STEP 0 から実装を開始して …

─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────
⏵⏵ accept edits on (shift+tab to cycle)
